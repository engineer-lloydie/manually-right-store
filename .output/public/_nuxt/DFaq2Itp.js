import{F as W,G as C,az as j,J as F,K,C as V,L as X,M as oe,ac as Y,a6 as se,ae as y,_ as G,r as J,l as D,aC as Q,aH as ue,aI as ce,V as E,ap as ie,aG as ve,Y as de,a3 as fe,aJ as me,N as A,o as he}from"./DjyUIBqy.js";import{h as ge,i as pe}from"./BO9Mla4O.js";import{g as Se}from"./BE2DUT4K.js";const Ve=C({renderless:Boolean,...Y()},"VVirtualScrollItem"),Te=W()({name:"VVirtualScrollItem",inheritAttrs:!1,props:Ve(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:u,emit:r,slots:t}=a;const{resizeRef:s,contentRect:i}=j(void 0,"border");F(()=>{var c;return(c=i.value)==null?void 0:c.height},c=>{c!=null&&r("update:height",c)}),K(()=>{var c,o;return l.renderless?V(X,null,[(c=t.default)==null?void 0:c.call(t,{itemRef:s})]):V("div",oe({ref:s,class:["v-virtual-scroll__item",l.class],style:l.style},u),[(o=t.default)==null?void 0:o.call(t)])})}}),we=-1,ye=1,H=100,Ie=C({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function Re(l,a){const u=se(),r=y(0);G(()=>{r.value=parseFloat(l.itemHeight||0)});const t=y(0),s=y(Math.ceil((parseInt(l.height)||u.height.value)/(r.value||16))||1),i=y(0),c=y(0),o=J(),f=J();let I=0;const{resizeRef:M,contentRect:k}=j();G(()=>{M.value=o.value});const T=D(()=>{var e;return o.value===document.documentElement?u.height.value:((e=k.value)==null?void 0:e.height)||parseInt(l.height)||0}),x=D(()=>!!(o.value&&f.value&&T.value&&r.value));let m=Array.from({length:a.value.length}),v=Array.from({length:a.value.length});const d=y(0);let h=-1;function P(e){return m[e]||r.value}const _=ue(()=>{const e=performance.now();v[0]=0;const n=a.value.length;for(let g=1;g<=n-1;g++)v[g]=(v[g-1]||0)+P(g-1);d.value=Math.max(d.value,performance.now()-e)},d),Z=F(x,e=>{e&&(Z(),I=f.value.offsetTop,_.immediate(),w(),~h&&ie(()=>{ve&&window.requestAnimationFrame(()=>{q(h),h=-1})}))});Q(()=>{_.clear()});function $(e,n){const g=m[e],p=r.value;r.value=p?Math.min(r.value,n):n,(g!==n||p!==r.value)&&(m[e]=n,_())}function S(e){return e=E(e,0,a.value.length-1),v[e]||0}function N(e){return be(v,e)}let O=0,R=0,z=0;F(T,(e,n)=>{n&&(w(),e<n&&requestAnimationFrame(()=>{R=0,w()}))});let B=-1;function ee(){if(!o.value||!f.value)return;const e=o.value.scrollTop,n=performance.now();n-z>500?(R=Math.sign(e-O),I=f.value.offsetTop):R=e-O,O=e,z=n,window.clearTimeout(B),B=window.setTimeout(L,500),w()}function L(){!o.value||!f.value||(R=0,z=0,window.clearTimeout(B),w())}let U=-1;function w(){cancelAnimationFrame(U),U=requestAnimationFrame(te)}function te(){if(!o.value||!T.value)return;const e=O-I,n=Math.sign(R),g=Math.max(0,e-H),p=E(N(g),0,a.value.length),ae=e+T.value+H,b=E(N(ae)+1,p+1,a.value.length);if((n!==we||p<t.value)&&(n!==ye||b>s.value)){const ne=S(t.value)-S(p),re=S(b)-S(s.value);Math.max(ne,re)>H?(t.value=p,s.value=b):(p<=0&&(t.value=p),b>=a.value.length&&(s.value=b))}i.value=S(t.value),c.value=S(a.value.length)-S(s.value)}function q(e){const n=S(e);!o.value||e&&!n?h=e:o.value.scrollTop=n}const le=D(()=>a.value.slice(t.value,s.value).map((e,n)=>({raw:e,index:n+t.value,key:ce(e)&&"value"in e?e.value:n+t.value})));return F(a,()=>{m=Array.from({length:a.value.length}),v=Array.from({length:a.value.length}),_.immediate(),w()},{deep:!0}),{calculateVisibleItems:w,containerRef:o,markerRef:f,computedItems:le,paddingTop:i,paddingBottom:c,scrollToIndex:q,handleScroll:ee,handleScrollend:L,handleItemResize:$}}function be(l,a){let u=l.length-1,r=0,t=0,s=null,i=-1;if(l[u]<a)return u;for(;r<=u;)if(t=r+u>>1,s=l[t],s>a)u=t-1;else if(s<a)i=t,r=t+1;else return s===a?t:r;return i}const ke=C({items:{type:Array,default:()=>[]},renderless:Boolean,...Ie(),...Y(),...pe()},"VVirtualScroll"),Fe=W()({name:"VVirtualScroll",props:ke(),setup(l,a){let{slots:u}=a;const r=de("VVirtualScroll"),{dimensionStyles:t}=ge(l),{calculateVisibleItems:s,containerRef:i,markerRef:c,handleScroll:o,handleScrollend:f,handleItemResize:I,scrollToIndex:M,paddingTop:k,paddingBottom:T,computedItems:x}=Re(l,fe(l,"items"));return me(()=>l.renderless,()=>{function m(){var h,P;const d=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";i.value===document.documentElement?(document[d]("scroll",o,{passive:!0}),document[d]("scrollend",f)):((h=i.value)==null||h[d]("scroll",o,{passive:!0}),(P=i.value)==null||P[d]("scrollend",f))}he(()=>{i.value=Se(r.vnode.el,!0),m(!0)}),Q(m)}),K(()=>{const m=x.value.map(v=>V(Te,{key:v.key,renderless:l.renderless,"onUpdate:height":d=>I(v.index,d)},{default:d=>{var h;return(h=u.default)==null?void 0:h.call(u,{item:v.raw,index:v.index,...d})}}));return l.renderless?V(X,null,[V("div",{ref:c,class:"v-virtual-scroll__spacer",style:{paddingTop:A(k.value)}},null),m,V("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:A(T.value)}},null)]):V("div",{ref:i,class:["v-virtual-scroll",l.class],onScrollPassive:o,onScrollend:f,style:[t.value,l.style]},[V("div",{ref:c,class:"v-virtual-scroll__container",style:{paddingTop:A(k.value),paddingBottom:A(T.value)}},[m])])}),{calculateVisibleItems:s,scrollToIndex:M}}});export{Fe as V};
